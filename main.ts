//% color="#006400" weight=50 icon="\uf1b9" block="呼噜猫游戏机"
namespace HuLuMaoGame {
    let asc = [
        0x00000000000000000000000000000000 ,//" "
        0x00101010101010101010000010100000 ,//"!"
        0x00006C6C242400000000010000000000 ,//"""
        0x0024242424FE48484848FC9090909000 ,//"#"
        0x00103C54929050381412129254781000 ,//"$"
        0x0000225C94A8481010242A5254880000 ,//"%"
        0x000030484850206E54948C888A740000 ,//"&"
        0x00003030101000000000000000000000 ,//"'"
        0x00040810102020202020201010080400 ,//"("
        0x00804020201010101010102020408000 ,//")"
        0x00000000105438103854100000000000 ,//"*"
        0x00000010101010FE1010101000000000 ,//"+"
        0x00000000000000000000000010102000 ,//""
        0x00000000000000FE0000000000000000 ,//"-"
        0x00000000000000000000000010100000 ,//"."
        0x00000404080810102020404080800000 ,//"/"
        0x00003844828282828282828244380000 ,//"0"
        0x000010701010101010101010107C0000 ,//"1"
        0x00003844828204081020408284FC0000 ,//"2"
        0x00003844820204380402028244380000 ,//"3"
        0x0000040C141424244444FE04040E0000 ,//"4"
        0x0000FC808080B8C48202028284780000 ,//"5"
        0x00003C428280B8C48282828244380000 ,//"6"
        0x00007E42820404080808101010100000 ,//"7"
        0x00003844828244384482828244380000 ,//"8"
        0x0000384482828282463A028244380000 ,//"9"
        0x00000000101000000000101000000000 ,//":"
        0x00000000101000000000001010200000 ,//";"
        0x00000000061860806018060000000000 ,//"<"
        0x000000000000FE0000FE000000000000 ,//"="
        0x00000000C0300C020C30C00000000000 ,//">"
        0x00384482820204081010100010100000 ,//"?"
        0x00003844829AAAAAAAAAAA9680423C00 ,//"@"
        0x000010101028282844447C4444EE0000 ,//"A"
        0x0000FC424242427C4242424242FC0000 ,//"B"
        0x00003C44828080808080828244380000 ,//"C"
        0x0000F844424242424242424244F80000 ,//"D"
        0x0000FC444240447C4440404244FC0000 ,//"E"
        0x0000FC444240447C4440404040F00000 ,//"F"
        0x0000344C828080808E8484844C340000 ,//"G"
        0x0000EE444444447C4444444444EE0000 ,//"H"
        0x00007C101010101010101010107C0000 ,//"I"
        0x00003E08080808080808088888700000 ,//"J"
        0x0000EE44484850605048484444EE0000 ,//"K"
        0x0000E040404040404040404244FC0000 ,//"L"
        0x0000C6446C6C6C545454444444EE0000 ,//"M"
        0x0000CE4464646454544C4C4C44E40000 ,//"N"
        0x00003844828282828282828244380000 ,//"O"
        0x0000F844424242447840404040E00000 ,//"P"
        0x0000384482828282828282BA443C0200 ,//"Q"
        0x0000F048444444487048444444E60000 ,//"R"
        0x00003C44828040300C02028244780000 ,//"S"
        0x00007C54921010101010101010380000 ,//"T"
        0x0000EE44444444444444444444380000 ,//"U"
        0x0000EE44444444282828281010100000 ,//"V"
        0x0000EE44545454545454282828280000 ,//"W"
        0x0000EE44442828101028284444EE0000 ,//"X"
        0x0000EE44442828281010101010380000 ,//"Y"
        0x00007E44840808102020408284FC0000 ,//"Z"
        0x001C1010101010101010101010101C00 ,//"["
        0x0000EE445454FE545454282828280000 ,//"\"
        0x00701010101010101010101010107000 ,//"]"
        0x00304884000000000000000000000000 ,//"^"
        0x0000000000000000000000000000FE00 ,//"_"
        0x00402000000000000000000000000000 ,//"`"
        0x0000000000007884047C84848C760000 ,//"a"
        0x0000C040404058644242424264580000 ,//"b"
        0x00000000000038448080808044380000 ,//"c"
        0x00000C040404344C848484844C360000 ,//"d"
        0x000000000000788484FC808084780000 ,//"e"
        0x000018242020F8202020202020700000 ,//"f"
        0x0000000000003A444478807C82827C00 ,//"g"
        0x0000C040404058644444444444EE0000 ,//"h"
        0x00001010000030101010101010380000 ,//"i"
        0x00001010000030101010101010906000 ,//"j"
        0x0000C04040405C485060504844EE0000 ,//"k"
        0x00003010101010111010101010390000 ,//"l"
        0x000000000000ACD29292929292D60000 ,//"m"
        0x00000000000058E44444444444EE0000 ,//"n"
        0x00000000000038448282828244380000 ,//"o"
        0x000000000000D864424242645840E000 ,//"p"
        0x000000000000364C8484844C34040E00 ,//"q"
        0x0000000000006C302020202020700000 ,//"r"
        0x00000000000078888460188444780000 ,//"s"
        0x000000202020F8202020202024180000 ,//"t"
        0x000000000000C64242424242463A0000 ,//"u"
        0x000000000000EE444428282810100000 ,//"v"
        0x000000000000EE444454542828280000 ,//"w"
        0x000000000000EE442810102844EE0000 ,//"x"
        0x000000000000EE444428281010A0C000 ,//"y"
        0x0000000000007E448810204284FC0000 ,//"z"
        0x000C1010101010601010101010100C00 ,//"{"
        0x00101010101010101010101010101000 ,//"|"
        0x00C0202020202018202020202020C000 ,//"}"
        0x00000000000000728C00000000000000 //"~"
    ]
    export enum LCDcolor {
        //% blockId="RED" block="红色"
        RED = 0xf800,
        //% blockId="GREEN" block="绿色"
        GREEN = 0x07e0,
        //% blockId="BLUE" block="蓝色"
        BLUE = 0x001f,
        //% blockId="WHITE" block="白色"
        WHITE = 0xffff,
        //% blockId="BLACK" block="黑色"
        BLACK = 0x0000,
        //% blockId="YELLOW" block="黄色"
        YELLOW = 0xFFE0,
        //% blockId="GRAY0" block="浅灰"
        GRAY0 = 0xEF7D,  	                    //灰色0 3165 00110 001011 00101
        //% blockId="GRAY1" block="中灰"
        GRAY1 = 0x8410,      	                //灰色1      00000 000000 00000
        //% blockId="GRAY2" block="深灰"
        GRAY2=0x4208      	                    //灰色2  1111111111011111
    }
    //写指令
    function LCDWriteindex (value: number) {
        pins.digitalWritePin(DigitalPin.P16, 0)
        pins.digitalWritePin(DigitalPin.P2, 0)
        pins.spiWrite(value)
        pins.digitalWritePin(DigitalPin.P16, 1)
    }
    //写8位数据
    function LCDWritedata (value: number) {
        pins.digitalWritePin(DigitalPin.P16, 0)
        pins.digitalWritePin(DigitalPin.P2, 1)
        pins.spiWrite(value)
        pins.digitalWritePin(DigitalPin.P16, 1)
    }
    //写16位数据
    function LCDWritedata16 (value: number) {
        pins.digitalWritePin(DigitalPin.P16, 0)
        pins.digitalWritePin(DigitalPin.P2, 1)
        pins.spiWrite(value >> 8)
        pins.spiWrite(value)
        pins.digitalWritePin(DigitalPin.P16, 1)
    }
    //设置lcd显示区域，在此区域写点数据自动换行
    function Lcd_SetRegion (x_s: number, y_s: number, x_e: number, y_e: number) {
        LCDWriteindex(42)
        LCDWritedata(0)
        LCDWritedata(x_s)
        LCDWritedata(0)
        LCDWritedata(x_e)
        LCDWriteindex(43)
        LCDWritedata(0)
        LCDWritedata(y_s)
        LCDWritedata(0)
        LCDWritedata(y_e)
        LCDWriteindex(44)
    }
    //LCD写Reg
    function Lcd_WriteReg (index: number, data: number) {
        LCDWriteindex(index)
        LCDWritedata(data)
    }
    //设置lcd显示起始点
    function Lcd_SetXY (x: number, y: number) {
        Lcd_SetRegion(x + 2, y + 1, x + 2, y + 1)
    }
    //画一个点
    function Gui_DrawPoint (x: number, y: number, data: number) {
        Lcd_SetRegion(x + 2, y + 1, x + 3, y + 2)
        LCDWritedata16(data)
    }
    /**
     * 
     * @param index
    */
    //% blockId=HuLuMaoGame_LcdInit block="初始化显示屏"
    //% weight=100
    //% blockGap=10
    //% color="#006400"
    //% name.fieldEditor="gridpicker" name.fieldOptions.columns=10
    export function LcdInit(): void {
        pins.setPull(DigitalPin.P16, PinPullMode.PullUp)
        pins.setPull(DigitalPin.P15, PinPullMode.PullUp)
        pins.setPull(DigitalPin.P14, PinPullMode.PullUp)
        pins.setPull(DigitalPin.P13, PinPullMode.PullUp)
        pins.setPull(DigitalPin.P12, PinPullMode.PullUp)
        pins.setPull(DigitalPin.P8, PinPullMode.PullUp)
        pins.spiFormat(8, 1)
        pins.spiPins(DigitalPin.P15, DigitalPin.P14, DigitalPin.P13)
        pins.spiFrequency(40000000)
        pins.digitalWritePin(DigitalPin.P8, 1)
        pins.digitalWritePin(DigitalPin.P12, 1)
        pins.digitalWritePin(DigitalPin.P12, 0)
        pins.digitalWritePin(DigitalPin.P12, 1)

        LCDReset()
        LCDWriteindex(17)
        basic.pause(120)
        LCDWriteindex(177)
        LCDWritedata(5)
        LCDWritedata(60)
        LCDWritedata(60)
        LCDWriteindex(178)
        LCDWritedata(5)
        LCDWritedata(60)
        LCDWritedata(60)
        LCDWriteindex(179)
        LCDWritedata(5)
        LCDWritedata(60)
        LCDWritedata(60)
        LCDWritedata(5)
        LCDWritedata(60)
        LCDWritedata(60)
        LCDWriteindex(180)
        LCDWritedata(3)
        LCDWriteindex(192)
        LCDWritedata(40)
        LCDWritedata(8)
        LCDWritedata(4)
        LCDWriteindex(193)
        LCDWritedata(192)
        LCDWriteindex(194)
        LCDWritedata(13)
        LCDWritedata(0)
        LCDWriteindex(195)
        LCDWritedata(141)
        LCDWritedata(42)
        LCDWriteindex(196)
        LCDWritedata(141)
        LCDWritedata(238)
        LCDWriteindex(197)
        LCDWritedata(26)
        LCDWriteindex(54)
        LCDWritedata(192)
        LCDWriteindex(224)
        LCDWritedata(4)
        LCDWritedata(34)
        LCDWritedata(7)
        LCDWritedata(10)
        LCDWritedata(46)
        LCDWritedata(48)
        LCDWritedata(37)
        LCDWritedata(42)
        LCDWritedata(40)
        LCDWritedata(38)
        LCDWritedata(46)
        LCDWritedata(58)
        LCDWritedata(0)
        LCDWritedata(1)
        LCDWritedata(3)
        LCDWritedata(19)
        LCDWriteindex(225)
        LCDWritedata(4)
        LCDWritedata(22)
        LCDWritedata(6)
        LCDWritedata(13)
        LCDWritedata(45)
        LCDWritedata(38)
        LCDWritedata(35)
        LCDWritedata(39)
        LCDWritedata(39)
        LCDWritedata(37)
        LCDWritedata(45)
        LCDWritedata(59)
        LCDWritedata(0)
        LCDWritedata(1)
        LCDWritedata(4)
        LCDWritedata(18)
        LCDWriteindex(58)
        LCDWritedata(5)
        LCDWriteindex(41)
    }
    /**
     * 
     * @param index
    */
    //% blockId=HuLuMaoGame_LCDReset block="复位显示屏"
    //% weight=99
    //% blockGap=10
    //% color="#006400"
    //% name.fieldEditor="gridpicker" name.fieldOptions.columns=10
    export function LCDReset () {
        pins.digitalWritePin(DigitalPin.P8, 0)
        basic.pause(300)
        pins.digitalWritePin(DigitalPin.P8, 1)
        basic.pause(100)
    }

    /**
     * 
     * @param index
    */
    //% blockId=HuLuMaoGame_Lcd_Clear block="清空屏幕并将底色设置为|%value"
    //% weight=98 
    //% blockGap=10
    //% color="#006400"
    //% name.fieldEditor="gridpicker" name.fieldOptions.columns=10
    export function Lcd_Clear (value:LCDcolor) {
        Lcd_SetRegion(2, 1, 129, 160)
        LCDWriteindex(44)
        for (let i = 0; i < 128; i++) {
            for (let i = 0; i < 160; i++) {
                LCDWritedata16(value)
            }
        }
    }
    /**
     * 
     * @param index
    */
    //% blockId=HuLuMaoGame_LCD_Gui_DrawFont_GBK16 block="在x=%x y=%y显示字符%text 字符颜色为%c1 底色为%c2"
    //% weight=98 
    //% blockGap=10
    //% color="#006400"
    //% name.fieldEditor="gridpicker" name.fieldOptions.columns=10
    export function LCD_Gui_DrawFont_GBK16(x:number,y:number,text:string,c1:LCDcolor,c2:LCDcolor) {
        let i, j, k, x0,num
        x0 = x
        
        for (let n = 0; n < text.length; n++){
            if (text.charCodeAt(n)<128) {
                k = text.charCodeAt(n)
                if (k == 13) {
                    x = x0
                    y += 16
                }
                else {
                    if (k > 32) k -= 32
                    else k = 0;
                    for (i = 120; i>=0; i-=8){
                        num = asc[k] >> i;
                        for (j = 0; j < 8; j++){
                            if (k <= 16) {
                                if (num & (0x80 >> j)) {
                                    Gui_DrawPoint(x + j, y + i, c1)
                                }
                                else {
                                    if (c1 != c2) {
                                        Gui_DrawPoint(x + j, y + i, c2)
                                    }
                                }
                            }
                        }
                    }
                    x += 8
                }
            }
        }
    }

}

